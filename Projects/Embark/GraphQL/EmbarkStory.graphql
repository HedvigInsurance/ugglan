fragment EmbarkLinkFragment on EmbarkLink {
    name
    label
}

fragment MessageFragment on EmbarkMessage {
    text
    expressions {
        ...ExpressionFragment
    }
}

fragment BasicExpressionFragment on EmbarkExpression {
    ... on EmbarkExpressionUnary {
        expressionUnaryType: type
        text
    }
    ... on EmbarkExpressionBinary {
        expressionBinaryType: type
        key
        value
        text
    }
}

fragment ExpressionFragment on EmbarkExpression {
    ...BasicExpressionFragment
    ... on EmbarkExpressionMultiple {
        expressionMultipleType: type
        text
        subExpressions {
            ...BasicExpressionFragment
              ... on EmbarkExpressionMultiple {
                expressionMultipleType: type
                text
                subExpressions {
                    ...BasicExpressionFragment
                      ... on EmbarkExpressionMultiple {
                        expressionMultipleType: type
                        text
                        subExpressions {
                            ...BasicExpressionFragment
                        }
                    }
                }
            }
        }
    }
}

fragment ResponseFragment on EmbarkResponse {
    ... on EmbarkMessage {
        ...MessageFragment
    }
    ... on EmbarkGroupedResponse {
        component
        items {
            ...MessageFragment
        }
        title {
            text
        }
    }
}

fragment ApiSingleVariableFragment on EmbarkAPIGraphQLSingleVariable {
    key
    from
    as
}

fragment ApiGeneratedVariableFragment on EmbarkAPIGraphQLGeneratedVariable {
    key
    storeAs
    type
}

fragment ApiMultiActionVariableFragment on EmbarkAPIGraphQLMultiActionVariable {
    key
    variables {
        ...ApiSingleVariableFragment
        ...ApiGeneratedVariableFragment
        ... on EmbarkAPIGraphQLMultiActionVariable {
            key
            variables {
                ...ApiSingleVariableFragment
                ...ApiGeneratedVariableFragment
            }
        }
    }
}

fragment ApiVariablesFragment on EmbarkAPIGraphQLVariable {
    ...ApiSingleVariableFragment
    ...ApiGeneratedVariableFragment
    ...ApiMultiActionVariableFragment
}

fragment ApiFragment on EmbarkApi {
    ... on EmbarkApiGraphQLQuery {
        data {
            next {
                ...EmbarkLinkFragment
            }
            query
            variables {
                ...ApiVariablesFragment
            }
            queryResults: results {
                key
                as
            }
        }
    }
    ... on EmbarkApiGraphQLMutation {
        data {
            next {
                ...EmbarkLinkFragment
            }
            mutation
            variables {
                ...ApiVariablesFragment
            }
            mutationResults: results {
               key
               as
            }
        }
    }
}

fragment EmbarkRedirectSingle on EmbarkRedirect {
  ... on EmbarkRedirectUnaryExpression {
    unaryType: type
    to
    passedExpressionKey
    passedExpressionValue
  }
  ... on EmbarkRedirectBinaryExpression {
    binaryType: type
    to
    key
    value
    passedExpressionKey
    passedExpressionValue
  }
}

fragment EmbarkRedirectFragment on EmbarkRedirect {
    ...EmbarkRedirectSingle
    ... on EmbarkRedirectMultipleExpressions {
        multipleType: type
        to
        passedExpressionKey
        passedExpressionValue
        subExpressions {
          ...ExpressionFragment
        }
    }
}

query EmbarkStory($name: String!) {
    embarkStory(name: $name) {
        id
        startPassage
        name
        passages {
            id
            name
            allLinks {
                ...EmbarkLinkFragment
            }
            response {
                ...ResponseFragment
            }
            messages {
                ...MessageFragment
            }
            api {
                ...ApiFragment
            }
            redirects {
              ...EmbarkRedirectFragment
            }
            action {
                ... on EmbarkActionCore {
                    component
                }
                ... on EmbarkTextAction {
                    component
                    textActionData: data {
                        key
                        placeholder
                        link {
                            ...EmbarkLinkFragment
                        }
                    }
                }
                ... on EmbarkNumberAction {
                    component
                    numberActionData: data {
                        key
                        placeholder
                        unit
                        maxValue
                        minValue
                        link {
                            ...EmbarkLinkFragment
                        }
                    }
                }
                ... on EmbarkTextActionSet {
                    textActionSetData: data {
                        link {
                            ...EmbarkLinkFragment
                        }
                        textActions {
                            data {
                              key
                                placeholder
                            }
                        }
                    }
                }
                ... on EmbarkSelectAction {
                    component
                    selectActionData: data {
                        options {
                            keys
                            values
                            link {
                                ...EmbarkLinkFragment
                            }
                        }
                    }
                }
            }
        }
    }
}
