fragment EmbarkLinkFragment on EmbarkLink {
    name
    label
}

fragment MessageFragment on EmbarkMessage {
    text
    expressions {
        ...ExpressionFragment
    }
}

fragment BasicExpressionFragment on EmbarkExpression {
    ... on EmbarkExpressionUnary {
        expressionUnaryType: type
        text
    }
    ... on EmbarkExpressionBinary {
        expressionBinaryType: type
        key
        value
        text
    }
}

fragment ExpressionFragment on EmbarkExpression {
    ...BasicExpressionFragment
    ... on EmbarkExpressionMultiple {
        expressionMultipleType: type
        text
        subExpressions {
            ...BasicExpressionFragment
        }
    }
}

fragment ResponseFragment on EmbarkResponse {
    ... on EmbarkMessage {
        ...MessageFragment
    }
    ... on EmbarkGroupedResponse {
        component
        items {
            ...MessageFragment
        }
        title {
            ...MessageFragment
        }
    }
}

query EmbarkStory($name: String!) {
    embarkStory(name: $name) {
        id
        startPassage
        name
        passages {
            id
            name
            response {
                ...ResponseFragment
            }
            messages {
                ...MessageFragment
            }
            action {
                ... on EmbarkActionCore {
                    component
                }
                ... on EmbarkTextAction {
                    component
                    textActionData: data {
                        key
                        placeholder
                        link {
                            ...EmbarkLinkFragment
                        }
                    }
                }
                ... on EmbarkNumberAction {
                    component
                    numberActionData: data {
                        key
                        placeholder
                        unit
                        maxValue
                        minValue
                        link {
                            ...EmbarkLinkFragment
                        }
                    }
                }
                ... on EmbarkSelectAction {
                    component
                    selectActionData: data {
                        options {
                            key
                            value
                            link {
                                ...EmbarkLinkFragment
                            }
                        }
                    }
                }
            }
        }
    }
}
